<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BanditPAM: BanditPAM: Almost Linear-Time &lt;em&gt;k&lt;/em&gt;-Medoids Clustering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BanditPAM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">BanditPAM: Almost Linear-Time <em>k</em>-Medoids Clustering </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This repo contains a high-performance implementation of BanditPAM from <a href="https://arxiv.org/abs/2006.06856">https://arxiv.org/abs/2006.06856</a>. The code can be called directly from Python or C++.</p>
<p >If you use this software, please cite:</p>
<p >Mo Tiwari, Martin Jinye Zhang, James Mayclin, Sebastian Thrun, Chris Piech, Ilan Shomorony. "Bandit-PAM: Almost Linear Time *k*-medoids Clustering via Multi-Armed Bandits" Advances in Neural Information Processing Systems (NeurIPS) 2020.</p>
<div class="fragment"><div class="line"><span class="preprocessor">@inproceedings</span>{BanditPAM,</div>
<div class="line">  title={Bandit-PAM: Almost Linear Time k-medoids Clustering via Multi-Armed Bandits},</div>
<div class="line">  author={Tiwari, Mo <span class="keywordflow">and</span> Zhang, Martin J <span class="keywordflow">and</span> Mayclin, James <span class="keywordflow">and</span> Thrun, Sebastian <span class="keywordflow">and</span> Piech, Chris <span class="keywordflow">and</span> Shomorony, Ilan},</div>
<div class="line">  booktitle={Advances <span class="keywordflow">in</span> Neural Information Processing Systems},</div>
<div class="line">  pages={368--374},</div>
<div class="line">  year={2020}</div>
<div class="line">}</div>
</div><!-- fragment --> <h1>Requirements</h1>
<p >This repo has the following requirements:</p>
<div class="fragment"><div class="line">Python &gt;= 3.5</div>
<div class="line">gcc &gt;= 5.4</div>
</div><!-- fragment --><p> It is highly encouraged that to use BanditPAM in a *nix machine for high performance and ease of installation. Windows is generally supported, but can be unstable depending on the C++ compiler/environment.</p>
<h1>Python Quickstart</h1>
<h2>Install the repo and its dependencies:</h2>
<p >This can be done either through </p><div class="fragment"><div class="line">/BanditPAM/: pip install BanditPAM</div>
<div class="line">/BanditPAM/: pip install -r requirements.txt</div>
</div><!-- fragment --><p> or through </p><div class="fragment"><div class="line">/BanditPAM/: pip install -r requirements.txt</div>
<div class="line">/BanditPAM/: sudo pip install .</div>
</div><!-- fragment --><h3>Example 1: Synthetic data from a Gaussian Mixture Model</h3>
<div class="fragment"><div class="line"><span class="keyword">from</span> BanditPAM <span class="keyword">import</span> KMedoids</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Generate data from a Gaussian Mixture Model with the given means:</span></div>
<div class="line">np.random.seed(0)</div>
<div class="line">n_per_cluster = 40</div>
<div class="line">means = np.array([[0,0], [-5,5], [5,5]])</div>
<div class="line">X = np.vstack([np.random.randn(n_per_cluster, 2) + mu <span class="keywordflow">for</span> mu <span class="keywordflow">in</span> means])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Fit the data with BanditPAM:</span></div>
<div class="line">kmed = <a class="code" href="classKMedoids.html">KMedoids</a>(n_medoids = 3, algorithm = <span class="stringliteral">&quot;BanditPAM&quot;</span>)</div>
<div class="line"><span class="comment"># Writes results to gmm_log</span></div>
<div class="line">kmed.fit(X, <span class="stringliteral">&#39;L2&#39;</span>, 3, <span class="stringliteral">&quot;gmm_log&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Visualize the data and the medoids:</span></div>
<div class="line"><span class="keywordflow">for</span> p_idx, point <span class="keywordflow">in</span> enumerate(X):</div>
<div class="line">    <span class="keywordflow">if</span> p_idx <span class="keywordflow">in</span> map(int, kmed.medoids):</div>
<div class="line">        plt.scatter(X[p_idx, 0], X[p_idx, 1], color=<span class="stringliteral">&#39;red&#39;</span>, s = 40)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        plt.scatter(X[p_idx, 0], X[p_idx, 1], color=<span class="stringliteral">&#39;blue&#39;</span>, s = 10)</div>
<div class="line">plt.show()</div>
<div class="ttc" id="aclassKMedoids_html"><div class="ttname"><a href="classKMedoids.html">KMedoids</a></div><div class="ttdoc">Class implementation for running KMedoids methods.</div><div class="ttdef"><b>Definition:</b> kmedoids_ucb.hpp:129</div></div>
</div><!-- fragment --><p ><img src="README_7_0.png" alt="" class="inline" title="png"/></p>
<h3>Example 2: MNIST and its medoids visualized via t-SNE</h3>
<div class="fragment"><div class="line"><span class="comment"># Start in the repository root directory, i.e. &#39;/BanditPAM/&#39;.</span></div>
<div class="line"><span class="keyword">from</span> BanditPAM <span class="keyword">import</span> KMedoids</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keyword">from</span> sklearn.manifold <span class="keyword">import</span> TSNE</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Load the 1000-point subset of MNIST and calculate its t-SNE embeddings for visualization:</span></div>
<div class="line">X = pd.read_csv(<span class="stringliteral">&#39;data/MNIST-1k.csv&#39;</span>, sep=<span class="stringliteral">&#39; &#39;</span>, header=<span class="keywordtype">None</span>).to_numpy()</div>
<div class="line">X_tsne = TSNE(n_components = 2).fit_transform(X)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Fit the data with BanditPAM:</span></div>
<div class="line">kmed = <a class="code" href="classKMedoids.html">KMedoids</a>(n_medoids = 10, algorithm = <span class="stringliteral">&quot;BanditPAM&quot;</span>)</div>
<div class="line">kmed.fit(X, <span class="stringliteral">&#39;L2&#39;</span>, 10, <span class="stringliteral">&quot;mnist_log&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Visualize the data and the medoids via t-SNE:</span></div>
<div class="line"><span class="keywordflow">for</span> p_idx, point <span class="keywordflow">in</span> enumerate(X):</div>
<div class="line">    <span class="keywordflow">if</span> p_idx <span class="keywordflow">in</span> map(int, kmed.medoids):</div>
<div class="line">        plt.scatter(X_tsne[p_idx, 0], X_tsne[p_idx, 1], color=<span class="stringliteral">&#39;red&#39;</span>, s = 40)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        plt.scatter(X_tsne[p_idx, 0], X_tsne[p_idx, 1], color=<span class="stringliteral">&#39;blue&#39;</span>, s = 5)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p> The corresponding logfile for this run, <code>mnist_log</code>, will contain the run's results and additional statistics in a format that can be easily read into json.</p>
<h2>Building the C++ executable from source</h2>
<p >Please note that it is <em>NOT</em> necessary to build the C++ executable from source to use the Python code above. However, if you would like to use the C++ executable directly, follow the instructions below.</p>
<h3>Option 1: Building with Docker</h3>
<p >We highly recommend building using Docker. One can download and install Docker by following instructions at the <a href="https://docs.docker.com/get-docker/">Docker install page</a>. Once you have Docker installed and the Docker Daemon is running, run the following commands:</p>
<div class="fragment"><div class="line">/BanditPAM$ chmod +x env_setup.sh</div>
<div class="line">/BanditPAM$ ./env_setup.sh</div>
<div class="line">/BanditPAM$ ./run_docker.sh</div>
</div><!-- fragment --><p >which will start a Docker instance with the necessary dependencies. Then:</p>
<div class="fragment"><div class="line">/BanditPAM$ mkdir build &amp;&amp; cd build</div>
<div class="line">/BanditPAM/build$ cmake .. &amp;&amp; make</div>
</div><!-- fragment --><p >This will create an executable named <code>BanditPAM</code> in <code>BanditPAM/build/src</code>.</p>
<h3>Option 2: Installing Requirements and Building Directly</h3>
<p >Building this repository requires four external requirements:</p><ul>
<li>Cmake &gt;= 3.17, <a href="https://cmake.org/download/">https://cmake.org/download/</a></li>
<li>Armadillo &gt;= 9.7, <a href="http://arma.sourceforge.net/download.html">http://arma.sourceforge.net/download.html</a></li>
<li>OpenMP &gt;= 2.5, <a href="https://www.openmp.org/resources/openmp-compilers-tools/">https://www.openmp.org/resources/openmp-compilers-tools/</a> (OpenMP is supported by default on most Linux platforms, and can be downloaded through homebrew on MacOS. For instructions on installing homebrew, see <a href="https://brew.sh/">https://brew.sh/</a>.)</li>
<li>CARMA &gt;= 0.3.0, <a href="https://github.com/RUrlus/carma">https://github.com/RUrlus/carma</a> (use the <code>unstable</code> branch)</li>
</ul>
<p >If installing these requirements from source, one can generally use the following procedure to install each requirement from the library's root folder (with CARMA used as an example here): </p><div class="fragment"><div class="line">/BanditPAM$ cd headers/carma</div>
<div class="line">/BanditPAM/headers/carma$ mkdir build &amp;&amp; cd build</div>
<div class="line">/BanditPAM/headers/carma/build$ cmake .. &amp;&amp; make &amp;&amp; make install</div>
</div><!-- fragment --><p >Further installation information for MacOS, Linux, and Windows is available in the [docs folder](docs). Ensure all the requirements above are installed and then run:</p>
<div class="fragment"><div class="line">/BanditPAM$ mkdir build &amp;&amp; cd build</div>
<div class="line">/BanditPAM/build$ cmake .. &amp;&amp; make</div>
</div><!-- fragment --><p >This will create an executable named <code>BanditPAM</code> in <code>BanditPAM/build/src</code>.</p>
<h2>C++ Usage</h2>
<p >Once the executable has been built, it can be invoked with: </p><div class="fragment"><div class="line">/BanditPAM/build/src/BanditPAM -f [path/to/input.csv] -k [number of clusters] -v [verbosity level]</div>
</div><!-- fragment --><ul>
<li><code>-f</code> is mandatory and specifies the path to the dataset</li>
<li><code>-k</code> is mandatory and specifies the number of clusters with which to fit the data</li>
<li><code>-v</code> is optional and specifies the verbosity level.</li>
</ul>
<p >For example, if you ran <code>./env_setup.sh</code> and downloaded the MNIST dataset, you could run:</p>
<div class="fragment"><div class="line">/BanditPAM/build/src/BanditPAM -f ../data/MNIST-1k.csv -k 10 -v 1</div>
</div><!-- fragment --><p >The expected output in the command line will be: </p><div class="fragment"><div class="line">Medoids: 694,168,306,714,324,959,527,251,800,737</div>
</div><!-- fragment --><p> A file called <code>KMedoidsLogfile</code> with detailed logs during the process will also be present.</p>
<h2>Testing</h2>
<p >To run the full suite of tests, run in the root directory:</p>
<div class="fragment"><div class="line">/BanditPAM$ python -m unittest discover -s tests</div>
</div><!-- fragment --><p >Alternatively, to run a "smaller" set of tests, from the main repo folder run <code>python tests/test_commit.py</code> or <code>python tests/test_push.py</code> to run a set of longer, more intensive tests.</p>
<h2>Reproducing Figures from the Paper</h2>
<p >Note that some figures in the original paper were generated using the Python code at <a href="https://github.com/motiwari/BanditPAM-python">https://github.com/motiwari/BanditPAM-python</a>. That code is not pretty, nor is it maintained. It only exists for reference and for reproducibility of the plots.</p>
<h2>Credits</h2>
<p >Eric Frankel refined the C++ implementation of BanditPAM, exposed it via Python bindings, registered the package on PyPi, wrote the documentation and test cases, and is now the maintainer of the code.</p>
<p >James Mayclin developed the initial C++ implementation of BanditPAM.</p>
<p >Mo Tiwari wrote the original Python implementation of BanditPAM. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
